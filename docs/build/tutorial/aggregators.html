<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Aggregators and Imputers · TSML Documentation</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>TSML Documentation</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../search.html"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../index.html">HOME</a></li><li><span class="toctext">Tutorial</span><ul><li class="current"><a class="toctext" href="aggregators.html">Aggregators and Imputers</a><ul class="internal"><li><a class="toctext" href="#DateValgator-1">DateValgator</a></li><li><a class="toctext" href="#DateValNNer-1">DateValNNer</a></li><li><a class="toctext" href="#DateValizer-1">DateValizer</a></li></ul></li><li><a class="toctext" href="pipeline.html">Pipeline</a></li><li><a class="toctext" href="statistics.html">Statistical Metrics</a></li><li><a class="toctext" href="tsdetectors.html">TS Data Discovery</a></li></ul></li><li><span class="toctext">Manual</span><ul><li><a class="toctext" href="../man/dateproc.html">Date Processing</a></li><li><a class="toctext" href="../man/valueproc.html">Value Processing</a></li><li><a class="toctext" href="../man/aggregation.html">Aggregation</a></li><li><a class="toctext" href="../man/imputation.html">Imputation</a></li><li><a class="toctext" href="../man/monotonic.html">Monotonic Detection</a></li><li><a class="toctext" href="../man/tsclassification.html">TS Classification</a></li><li><a class="toctext" href="../man/cli.html">CLI Wrappers</a></li></ul></li><li><span class="toctext">Library</span><ul><li><a class="toctext" href="../lib/decisiontree.html">Decision Tree</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li>Tutorial</li><li><a href="aggregators.html">Aggregators and Imputers</a></li></ul><a class="edit-page" href="https://github.com/IBM/TSML.jl/blob/master/docs/src/tutorial/aggregators.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Aggregators and Imputers</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Aggregators-and-Imputers-1" href="#Aggregators-and-Imputers-1">Aggregators and Imputers</a></h1><p>The package assumes a two-column input composed of Dates and Values.  The first part of the workflow aggregates values based on the specified  date/time interval which minimizes occurence of missing values and noise.  The aggregated data is then left-joined to the complete sequence of dates  in a specified date/time interval. Remaining missing values are replaced  by k nearest neighbors where k is the symmetric distance from the location  of missing value. This approach can be called several times until there  are no more missing values.</p><p>Let us create Date, Value input with some missing values and apply TSML functions to normalize/clean the data:</p><pre><code class="language-julia">using Random, Dates, DataFrames
function generateDataWithMissing()
   Random.seed!(123)
   gdate = DateTime(2014,1,1):Dates.Minute(15):DateTime(2016,1,1)
   gval = Array{Union{Missing,Float64}}(rand(length(gdate)))
   gmissing = 50000
   gndxmissing = Random.shuffle(1:length(gdate))[1:gmissing]
   df = DataFrame(Date=gdate,Value=gval)
   df[:Value][gndxmissing] .= missing
   return df
end</code></pre><pre><code class="language-none">generateDataWithMissing (generic function with 1 method)</code></pre><p>Let&#39;s output the first 20 rows:</p><pre><code class="language-julia">X = generateDataWithMissing()
first(X,20)</code></pre><table class="data-frame"><thead><tr><th></th><th>Date</th><th>Value</th></tr><tr><th></th><th>Dates…</th><th>Float64⍰</th></tr></thead><tbody><p>20 rows × 2 columns</p><tr><th>1</th><td>2014-01-01T00:00:00</td><td>missing</td></tr><tr><th>2</th><td>2014-01-01T00:15:00</td><td>missing</td></tr><tr><th>3</th><td>2014-01-01T00:30:00</td><td>missing</td></tr><tr><th>4</th><td>2014-01-01T00:45:00</td><td>missing</td></tr><tr><th>5</th><td>2014-01-01T01:00:00</td><td>missing</td></tr><tr><th>6</th><td>2014-01-01T01:15:00</td><td>missing</td></tr><tr><th>7</th><td>2014-01-01T01:30:00</td><td>missing</td></tr><tr><th>8</th><td>2014-01-01T01:45:00</td><td>0.0521332</td></tr><tr><th>9</th><td>2014-01-01T02:00:00</td><td>0.26864</td></tr><tr><th>10</th><td>2014-01-01T02:15:00</td><td>0.108871</td></tr><tr><th>11</th><td>2014-01-01T02:30:00</td><td>0.163666</td></tr><tr><th>12</th><td>2014-01-01T02:45:00</td><td>0.473017</td></tr><tr><th>13</th><td>2014-01-01T03:00:00</td><td>0.865412</td></tr><tr><th>14</th><td>2014-01-01T03:15:00</td><td>missing</td></tr><tr><th>15</th><td>2014-01-01T03:30:00</td><td>missing</td></tr><tr><th>16</th><td>2014-01-01T03:45:00</td><td>missing</td></tr><tr><th>17</th><td>2014-01-01T04:00:00</td><td>0.275819</td></tr><tr><th>18</th><td>2014-01-01T04:15:00</td><td>0.446568</td></tr><tr><th>19</th><td>2014-01-01T04:30:00</td><td>0.582318</td></tr><tr><th>20</th><td>2014-01-01T04:45:00</td><td>missing</td></tr></tbody></table><h2><a class="nav-anchor" id="DateValgator-1" href="#DateValgator-1">DateValgator</a></h2><p>You&#39;ll notice several blocks of missing with reading frequency every 15 minutes.  Let&#39;s aggregate our dataset by taking the hourly median using the <code>DateValgator</code> transformer.</p><pre><code class="language-julia">using TSML
using TSML.TSMLTypes
using TSML.Utils
using TSML.TSMLTransformers
using TSML: DateValgator

dtvlgator = DateValgator(Dict(:dateinterval=&gt;Dates.Hour(1)))
fit!(dtvlgator,X)
results = transform!(dtvlgator,X)
first(results,20)</code></pre><table class="data-frame"><thead><tr><th></th><th>Date</th><th>Value</th></tr><tr><th></th><th>Dates…</th><th>Float64⍰</th></tr></thead><tbody><p>20 rows × 2 columns</p><tr><th>1</th><td>2014-01-01T00:00:00</td><td>missing</td></tr><tr><th>2</th><td>2014-01-01T01:00:00</td><td>missing</td></tr><tr><th>3</th><td>2014-01-01T02:00:00</td><td>0.108871</td></tr><tr><th>4</th><td>2014-01-01T03:00:00</td><td>0.473017</td></tr><tr><th>5</th><td>2014-01-01T04:00:00</td><td>0.361194</td></tr><tr><th>6</th><td>2014-01-01T05:00:00</td><td>0.582318</td></tr><tr><th>7</th><td>2014-01-01T06:00:00</td><td>0.918165</td></tr><tr><th>8</th><td>2014-01-01T07:00:00</td><td>0.614255</td></tr><tr><th>9</th><td>2014-01-01T08:00:00</td><td>0.690462</td></tr><tr><th>10</th><td>2014-01-01T09:00:00</td><td>0.92049</td></tr><tr><th>11</th><td>2014-01-01T10:00:00</td><td>0.621379</td></tr><tr><th>12</th><td>2014-01-01T11:00:00</td><td>0.19178</td></tr><tr><th>13</th><td>2014-01-01T12:00:00</td><td>0.946697</td></tr><tr><th>14</th><td>2014-01-01T13:00:00</td><td>missing</td></tr><tr><th>15</th><td>2014-01-01T14:00:00</td><td>0.172161</td></tr><tr><th>16</th><td>2014-01-01T15:00:00</td><td>0.777869</td></tr><tr><th>17</th><td>2014-01-01T16:00:00</td><td>0.0769717</td></tr><tr><th>18</th><td>2014-01-01T17:00:00</td><td>0.784423</td></tr><tr><th>19</th><td>2014-01-01T18:00:00</td><td>0.915008</td></tr><tr><th>20</th><td>2014-01-01T19:00:00</td><td>0.595896</td></tr></tbody></table><p>Missing values are now reduced because of the aggregation applied using <code>DateValgator</code> transformer. TSML transformers support the two main functions: <code>fit!</code> and <code>transform!</code>. <code>DateValgator fit!</code> performs initial setups of necessary parameters and validation of arguments while its <code>transform!</code> contains the algorithm for aggregation.</p><h2><a class="nav-anchor" id="DateValNNer-1" href="#DateValNNer-1">DateValNNer</a></h2><p>Let&#39;s perform further processing to replace the remaining missing values with their nearest neighbors.  We will use <code>DateValNNer</code> which is a TSML transformer to process the output of <code>DateValgator</code>. <code>DateValNNer</code> can also process non-aggregated data by first running similar workflow of <code>DateValgator</code> before performing its imputation routine.</p><pre><code class="language-julia">using TSML: DateValNNer

datevalnner = DateValNNer(Dict(:dateinterval=&gt;Dates.Hour(1)))
fit!(datevalnner, X)
results = transform!(datevalnner,X)
first(results,20)</code></pre><table class="data-frame"><thead><tr><th></th><th>Date</th><th>Value</th></tr><tr><th></th><th>Dates…</th><th>Float64⍰</th></tr></thead><tbody><p>20 rows × 2 columns</p><tr><th>1</th><td>2014-01-01T00:00:00</td><td>0.108871</td></tr><tr><th>2</th><td>2014-01-01T01:00:00</td><td>0.108871</td></tr><tr><th>3</th><td>2014-01-01T02:00:00</td><td>0.108871</td></tr><tr><th>4</th><td>2014-01-01T03:00:00</td><td>0.473017</td></tr><tr><th>5</th><td>2014-01-01T04:00:00</td><td>0.361194</td></tr><tr><th>6</th><td>2014-01-01T05:00:00</td><td>0.582318</td></tr><tr><th>7</th><td>2014-01-01T06:00:00</td><td>0.918165</td></tr><tr><th>8</th><td>2014-01-01T07:00:00</td><td>0.614255</td></tr><tr><th>9</th><td>2014-01-01T08:00:00</td><td>0.690462</td></tr><tr><th>10</th><td>2014-01-01T09:00:00</td><td>0.92049</td></tr><tr><th>11</th><td>2014-01-01T10:00:00</td><td>0.621379</td></tr><tr><th>12</th><td>2014-01-01T11:00:00</td><td>0.19178</td></tr><tr><th>13</th><td>2014-01-01T12:00:00</td><td>0.946697</td></tr><tr><th>14</th><td>2014-01-01T13:00:00</td><td>0.559429</td></tr><tr><th>15</th><td>2014-01-01T14:00:00</td><td>0.172161</td></tr><tr><th>16</th><td>2014-01-01T15:00:00</td><td>0.777869</td></tr><tr><th>17</th><td>2014-01-01T16:00:00</td><td>0.0769717</td></tr><tr><th>18</th><td>2014-01-01T17:00:00</td><td>0.784423</td></tr><tr><th>19</th><td>2014-01-01T18:00:00</td><td>0.915008</td></tr><tr><th>20</th><td>2014-01-01T19:00:00</td><td>0.595896</td></tr></tbody></table><p>After running the <code>DateValNNer</code>, it&#39;s guaranteed that there will be no more missing data. </p><h2><a class="nav-anchor" id="DateValizer-1" href="#DateValizer-1">DateValizer</a></h2><p>One more imputer to replace missing data is <code>DateValizer</code>. It computes the hourly median over 24 hours and use the hour =&gt; median mapping  to replace missing data with the hour as the key. Below is a sample workflow to replace missing data in X with the hourly medians.</p><pre><code class="language-julia">using TSML: DateValizer

datevalizer = DateValizer(Dict(:dateinterval=&gt;Dates.Hour(1)))
fit!(datevalizer, X)
results = transform!(datevalizer,X)
first(results,20)</code></pre><table class="data-frame"><thead><tr><th></th><th>Date</th><th>Value</th></tr><tr><th></th><th>Dates…</th><th>Float64⍰</th></tr></thead><tbody><p>20 rows × 2 columns</p><tr><th>1</th><td>2014-01-01T00:00:00</td><td>0.498827</td></tr><tr><th>2</th><td>2014-01-01T01:00:00</td><td>0.500748</td></tr><tr><th>3</th><td>2014-01-01T02:00:00</td><td>0.108871</td></tr><tr><th>4</th><td>2014-01-01T03:00:00</td><td>0.473017</td></tr><tr><th>5</th><td>2014-01-01T04:00:00</td><td>0.361194</td></tr><tr><th>6</th><td>2014-01-01T05:00:00</td><td>0.582318</td></tr><tr><th>7</th><td>2014-01-01T06:00:00</td><td>0.918165</td></tr><tr><th>8</th><td>2014-01-01T07:00:00</td><td>0.614255</td></tr><tr><th>9</th><td>2014-01-01T08:00:00</td><td>0.690462</td></tr><tr><th>10</th><td>2014-01-01T09:00:00</td><td>0.92049</td></tr><tr><th>11</th><td>2014-01-01T10:00:00</td><td>0.621379</td></tr><tr><th>12</th><td>2014-01-01T11:00:00</td><td>0.19178</td></tr><tr><th>13</th><td>2014-01-01T12:00:00</td><td>0.946697</td></tr><tr><th>14</th><td>2014-01-01T13:00:00</td><td>0.485543</td></tr><tr><th>15</th><td>2014-01-01T14:00:00</td><td>0.172161</td></tr><tr><th>16</th><td>2014-01-01T15:00:00</td><td>0.777869</td></tr><tr><th>17</th><td>2014-01-01T16:00:00</td><td>0.0769717</td></tr><tr><th>18</th><td>2014-01-01T17:00:00</td><td>0.784423</td></tr><tr><th>19</th><td>2014-01-01T18:00:00</td><td>0.915008</td></tr><tr><th>20</th><td>2014-01-01T19:00:00</td><td>0.595896</td></tr></tbody></table><footer><hr/><a class="previous" href="../index.html"><span class="direction">Previous</span><span class="title">HOME</span></a><a class="next" href="pipeline.html"><span class="direction">Next</span><span class="title">Pipeline</span></a></footer></article></body></html>
